<header class="top-bar">
    <div>
        <h2 class="page-title">Gestão de Notas Fiscais</h2>
        <p style="color: var(--text-muted); font-size: 0.9rem;">Controle e emissão de documentos fiscais organizados por entidade.</p>
    </div>
    <div style="display: flex; gap: 12px; align-items: center;">
        <div class="search-box-pro" style="width: 400px;">
            <i class="fas fa-search"></i>
            <input type="text" id="nfe-search-input" placeholder="Buscar por fornecedor, produto ou chave..." onkeyup="filterNFeBySearch(this.value)">
        </div>
        <button class="btn-primary" onclick="loadNFeTable()" title="Atualizar lista">
            <i class="fas fa-sync-alt"></i>
        </button>
    </div>
</header>

<!-- RESUMO FISCAL -->
<div class="kpi-grid-pro" style="margin-bottom: 24px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
    <div class="panel" style="padding: 16px; border-left: 4px solid var(--primary); display: flex; align-items: center; gap: 12px;">
        <div style="width: 40px; height: 40px; background: #dcfce7; color: #166534; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">
            <i class="fas fa-file-invoice-dollar"></i>
        </div>
        <div>
            <p style="font-size: 0.65rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase;">Total Emitido (Mês)</p>
            <h4 id="nfe-total-mes" style="font-size: 1.1rem; font-weight: 800; color: var(--primary);">R$ 0,00</h4>
        </div>
    </div>
    <div class="panel" style="padding: 16px; border-left: 4px solid var(--accent); display: flex; align-items: center; gap: 12px;">
        <div style="width: 40px; height: 40px; background: #fef3c7; color: #92400e; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">
            <i class="fas fa-clock"></i>
        </div>
        <div>
            <p style="font-size: 0.65rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase;">Aguardando Emissão</p>
            <h4 id="nfe-pending-count" style="font-size: 1.1rem; font-weight: 800; color: var(--accent);">0 Notas</h4>
        </div>
    </div>
</div>

<!-- FILTROS E ORGANIZAÇÃO -->
<div class="panel">
    <div class="panel-header">
        <div style="display: flex; gap: 20px; align-items: center;">
            <h4 style="font-weight: 700;">Arquivo de Notas Fiscais</h4>
            <div class="filter-group-pro">
                <button onclick="setNFeGrouping('fornecedor')" class="filter-btn active" id="btn-group-forn">Por Fornecedor</button>
                <button onclick="setNFeGrouping('data')" class="filter-btn" id="btn-group-data">Por Data</button>
                <button onclick="setNFeGrouping('status')" class="filter-btn" id="btn-group-status">Por Status</button>
            </div>
        </div>
        <div style="display: flex; gap: 10px;">
            <select id="nfe-month-filter" onchange="loadNFeTable()" class="minimal-select">
                <option value="all">Todos os Meses</option>
                <option value="current">Mês Atual</option>
                <option value="last">Mês Passado</option>
            </select>
        </div>
    </div>
    
    <!-- CONTAINER DINÂMICO DE NOTAS -->
    <div id="nfe-dynamic-container" style="padding: 20px;">
        <!-- Injetado via JS: Grupos de notas por fornecedor ou data -->
    </div>
</div>

<style>
.filter-group-pro {
    display: flex;
    background: #f1f5f9;
    padding: 4px;
    border-radius: 100px;
}

.nfe-group-header {
    background: #f8fafc;
    padding: 12px 20px;
    border-radius: 10px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.2s;
}

.nfe-group-header:hover {
    background: #f1f5f9;
}

.nfe-group-header h5 {
    font-weight: 700;
    color: var(--text-main);
    display: flex;
    align-items: center;
    gap: 10px;
}

.nfe-group-header .count-badge {
    background: var(--primary);
    color: white;
    font-size: 0.7rem;
    padding: 2px 8px;
    border-radius: 100px;
}

.nfe-list-item {
    display: grid;
    grid-template-columns: 100px 1fr 150px 120px 150px;
    padding: 14px 20px;
    border-bottom: 1px solid #f1f5f9;
    align-items: center;
    transition: background 0.2s;
}

.nfe-list-item:hover {
    background: #fcfcfc;
}

.nfe-list-item .date { font-size: 0.8rem; color: var(--text-muted); }
.nfe-list-item .info { font-weight: 600; }
.nfe-list-item .value { font-weight: 700; text-align: right; }
.nfe-list-item .status { text-align: center; }
.nfe-list-item .actions { text-align: right; }

.nfe-group-content {
    margin-bottom: 24px;
    animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.minimal-select {
    border: 1px solid var(--border);
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-main);
    background: white;
}

.filter-btn {
    padding: 6px 16px;
    border: none;
    background: transparent;
    color: var(--text-muted);
    font-size: 0.8rem;
    font-weight: 600;
    border-radius: 100px;
    cursor: pointer;
    transition: all 0.2s;
}

.filter-btn.active {
    background: var(--primary);
    color: white;
    box-shadow: 0 2px 8px rgba(26, 86, 50, 0.2);
}
</style>
