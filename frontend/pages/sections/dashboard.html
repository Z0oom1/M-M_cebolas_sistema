<header class="top-bar">
    <div>
        <h2 class="page-title">Painel de Controle Profissional</h2>
        <p style="color: var(--text-muted); font-size: 0.9rem;">Gestão estratégica e análise de dados em tempo real.</p>
    </div>
    <div style="display: flex; gap: 12px; align-items: center;">
        <div class="dashboard-filters" style="display: flex; gap: 8px; background: white; padding: 4px; border-radius: 100px; border: 1px solid var(--border);">
            <button onclick="setDashboardPeriod('hoje')" class="filter-btn active" id="btn-period-hoje">Hoje</button>
            <button onclick="setDashboardPeriod('semana')" class="filter-btn" id="btn-period-semana">Semana</button>
            <button onclick="setDashboardPeriod('mes')" class="filter-btn" id="btn-period-mes">Mês</button>
            <button onclick="setDashboardPeriod('ano')" class="filter-btn" id="btn-period-ano">Ano</button>
            <button onclick="openCustomFilterModal()" class="filter-btn" style="padding: 6px 10px;"><i class="fas fa-filter"></i></button>
        </div>
        <button class="btn-icon" onclick="refreshDashboard()" title="Atualizar dados" style="padding: 8px 14px; border-radius: 100px; border: 1px solid var(--border); background: white; font-size: 0.82rem; font-weight: 700; color: var(--text-muted); display: flex; align-items: center; gap: 6px;">
            <i class="fas fa-sync-alt"></i>
        </button>
    </div>
</header>

<!-- DASHBOARD CONFIGURÁVEL: GRID DE KPIS -->
<div id="kpi-container" class="kpi-grid-pro">
    <!-- Os cards serão injetados e podem ser reordenados ou ocultados via config -->
</div>

<!-- SEÇÃO DE ANÁLISE GRÁFICA AVANÇADA -->
<div class="analysis-row">
    <div class="panel main-chart">
        <div class="panel-header">
            <div style="display: flex; flex-direction: column;">
                <h4 style="font-weight: 700;">Análise de Performance</h4>
                <span style="font-size: 0.7rem; color: var(--text-muted);">Comparativo de fluxo e volume</span>
            </div>
            <div class="chart-controls">
                <select id="chart-metric-select" onchange="updateMainChart()" class="minimal-select">
                    <option value="financeiro">Financeiro (R$)</option>
                    <option value="volume_cx">Volume (Caixas)</option>
                    <option value="volume_kg">Volume (Kg)</option>
                </select>
                <div class="toggle-group">
                    <button onclick="setChartType('bar')" class="toggle-btn active" id="btn-chart-bar"><i class="fas fa-chart-bar"></i></button>
                    <button onclick="setChartType('line')" class="toggle-btn" id="btn-chart-line"><i class="fas fa-chart-line"></i></button>
                </div>
            </div>
        </div>
        <div class="chart-body">
            <canvas id="mainDashboardChart"></canvas>
        </div>
    </div>

    <div class="panel side-panel">
        <div class="panel-header">
            <h4 style="font-weight: 700;">Mix de Produtos</h4>
        </div>
        <div class="chart-body compact">
            <canvas id="distributionChart"></canvas>
        </div>
        <div id="product-legend" class="custom-legend">
            <!-- Legenda personalizada via JS -->
        </div>
    </div>
</div>

<!-- TABELAS DE GESTÃO ORGANIZADAS -->
<div class="data-row">
    <!-- RANKING DE FORNECEDORES (Novo) -->
    <div class="panel">
        <div class="panel-header">
            <h4 style="font-weight: 700;"><i class="fas fa-medal" style="color: #f59e0b;"></i> Principais Fornecedores</h4>
            <div class="search-box-mini">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Filtrar..." onkeyup="filterDashTable('supplier-rank-table', this.value)">
            </div>
        </div>
        <div class="table-container">
            <table id="supplier-rank-table" class="table-pro">
                <thead>
                    <tr>
                        <th>Fornecedor</th>
                        <th style="text-align: center;">Vol. (Cx)</th>
                        <th style="text-align: right;">Total (R$)</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="dash-supplier-ranking">
                    <!-- Injetado via JS -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- ESTOQUE DETALHADO -->
    <div class="panel">
        <div class="panel-header">
            <h4 style="font-weight: 700;"><i class="fas fa-warehouse" style="color: var(--primary);"></i> Inventário em Tempo Real</h4>
            <button class="btn-text" onclick="showSection('estoque')">Ver Detalhes</button>
        </div>
        <div class="table-container">
            <table class="table-pro">
                <thead>
                    <tr>
                        <th>Produto</th>
                        <th style="text-align: center;">Cx</th>
                        <th style="text-align: center;">Kg</th>
                        <th>Tendência</th>
                    </tr>
                </thead>
                <tbody id="dash-inventory-table">
                    <!-- Injetado via JS -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- ÚLTIMAS TRANSAÇÕES COM FILTRO GLOBAL -->
<div class="panel">
    <div class="panel-header">
        <h4 style="font-weight: 700;"><i class="fas fa-exchange-alt"></i> Fluxo de Operações Recentes</h4>
        <div style="display: flex; gap: 10px;">
            <div class="search-box-pro">
                <i class="fas fa-search"></i>
                <input type="text" id="global-dash-search" placeholder="Buscar em tudo (fornecedor, produto, nota)..." onkeyup="globalDashSearch(this.value)">
            </div>
        </div>
    </div>
    <div class="table-container">
        <table class="table-pro" id="dash-main-ops-table">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Operação</th>
                    <th>Entidade</th>
                    <th>Produto</th>
                    <th style="text-align: center;">Qtd</th>
                    <th style="text-align: right;">Valor</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="dash-recent-ops">
                <!-- Injetado via JS -->
            </tbody>
        </table>
    </div>
</div>

<style>
/* Estilos Pro para o Dashboard */
.kpi-grid-pro {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
}

.analysis-row {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 24px;
    margin-bottom: 24px;
}

.data-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
    margin-bottom: 24px;
}

.filter-btn {
    padding: 6px 16px;
    border: none;
    background: transparent;
    color: var(--text-muted);
    font-size: 0.8rem;
    font-weight: 600;
    border-radius: 100px;
    cursor: pointer;
    transition: all 0.2s;
}

.filter-btn.active {
    background: var(--primary);
    color: white;
    box-shadow: 0 2px 8px rgba(26, 86, 50, 0.2);
}

.minimal-select {
    border: 1px solid var(--border);
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-main);
    background: white;
}

.toggle-group {
    display: flex;
    background: #f1f5f9;
    padding: 3px;
    border-radius: 8px;
}

.toggle-btn {
    border: none;
    background: transparent;
    padding: 5px 10px;
    border-radius: 6px;
    cursor: pointer;
    color: var(--text-muted);
}

.toggle-btn.active {
    background: white;
    color: var(--primary);
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.chart-body { height: 320px; padding: 20px; }
.chart-body.compact { height: 220px; }

.table-pro { width: 100%; border-collapse: collapse; }
.table-pro th { padding: 12px 20px; font-size: 0.7rem; text-transform: uppercase; color: var(--text-muted); border-bottom: 1px solid var(--border); text-align: left; }
.table-pro td { padding: 14px 20px; font-size: 0.85rem; border-bottom: 1px solid #f8fafc; }

.search-box-mini { position: relative; width: 150px; }
.search-box-mini i { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); font-size: 0.75rem; color: var(--text-muted); }
.search-box-mini input { width: 100%; padding: 6px 10px 6px 30px; border-radius: 6px; border: 1px solid var(--border); font-size: 0.75rem; }

.search-box-pro { position: relative; width: 350px; }
.search-box-pro i { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }
.search-box-pro input { width: 100%; padding: 10px 15px 10px 40px; border-radius: 10px; border: 1px solid var(--border); }

.btn-text { background: none; border: none; color: var(--primary); font-weight: 700; font-size: 0.8rem; cursor: pointer; }

@media (max-width: 1200px) {
    .analysis-row, .data-row { grid-template-columns: 1fr; }
}
</style>
