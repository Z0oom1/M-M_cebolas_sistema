<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M&M Cebolas - Gestão</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/estilo_geral.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="titlebar" style="display: none;">
        <div class="window-title">M&M CEBOLAS - SISTEMA DE GESTÃO</div>
        <div class="window-controls">
            <button id="minBtn" class="control-btn minimize" title="Minimizar"></button>
            <button id="maxBtn" class="control-btn maximize" title="Maximizar"></button>
            <button id="closeBtn" class="control-btn close" title="Fechar"></button>
        </div>
    </div>

    <button id="mobile-menu-btn" class="mobile-menu-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-container">
                <img src="../Imgs/logo_M&M.jpg" alt="Logo M&M" class="logo-img">
            </div>
            <h1 class="sidebar-title">M&M CEBOLAS</h1>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-group">
                <span class="nav-label">PRINCIPAL</span>
                <button class="nav-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-chart-line"></i> Dashboard
                </button>
            </div>
            <div class="nav-group">
                <span class="nav-label">OPERACIONAL</span>
                <button class="nav-item" onclick="showSection('entrada')">
                    <i class="fas fa-shopping-cart"></i> Compra
                </button>
                <button class="nav-item" onclick="showSection('saida')">
                    <i class="fas fa-hand-holding-usd"></i> Venda
                </button>
                <button class="nav-item" onclick="showSection('estoque')">
                    <i class="fas fa-boxes"></i> Estoque
                </button>
            </div>
            <div class="nav-group">
                <span class="nav-label">CADASTROS</span>
                <button class="nav-item" onclick="showSection('cadastro')">
                    <i class="fas fa-address-book"></i> Contatos
                </button>
                <button class="nav-item" onclick="showSection('nfe')">
                    <i class="fas fa-file-invoice"></i> Notas Fiscais
                </button>
            </div>
            <div class="nav-group">
                <span class="nav-label">SISTEMA</span>
                <button class="nav-item" onclick="showSection('financeiro')">
                    <i class="fas fa-wallet"></i> Financeiro
                </button>
                <button class="nav-item" onclick="showSection('config')">
                    <i class="fas fa-cog"></i> Configurações
                </button>
            </div>
        </nav>
        <div class="sidebar-footer">
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-power-off"></i> Sair
            </button>
        </div>
    </div>

    <main class="main-content" id="main-content">
        <!-- Conteúdo injetado via JS -->
    </main>

    <!-- Modal de Produto -->
    <div id="modal-produto" class="modal-overlay">
        <div class="edit-modal" style="max-width: 600px; padding: 0; overflow: hidden; border-radius: 20px;">
            <div class="panel-header" style="background: var(--primary); color: white; padding: 20px;">
                <h3 id="produto-modal-title" style="margin: 0;">Gestão de Produto</h3>
                <button onclick="closeProdutoModal()" style="background:none; border:none; font-size:1.8rem; cursor:pointer; color: white;">&times;</button>
            </div>
            <form onsubmit="saveProduto(event)" style="padding: 24px;">
                <input type="hidden" id="prod-id">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group" style="grid-column: span 2;">
                        <label>Nome da Variedade</label>
                        <input type="text" id="prod-nome" required placeholder="Ex: Cebola Amarela Extra">
                    </div>
                    <div class="form-group">
                        <label>NCM</label>
                        <input type="text" id="prod-ncm" placeholder="07031019">
                    </div>
                    <div class="form-group">
                        <label>Preço Base (R$)</label>
                        <input type="number" step="0.01" id="prod-preco" required placeholder="0.00">
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label>Escolha um Ícone</label>
                        <div id="icon-selector" class="icon-grid" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-top: 10px;">
                            <div class="icon-option active" onclick="selectIcon(this, 'fa-box')" data-icon="fa-box"><i class="fas fa-box"></i></div>
                            <div class="icon-option" onclick="selectIcon(this, 'fa-seedling')" data-icon="fa-seedling"><i class="fas fa-seedling"></i></div>
                            <div class="icon-option" onclick="selectIcon(this, 'fa-leaf')" data-icon="fa-leaf"><i class="fas fa-leaf"></i></div>
                            <div class="icon-option" onclick="selectIcon(this, 'fa-carrot')" data-icon="fa-carrot"><i class="fas fa-carrot"></i></div>
                            <div class="icon-option" onclick="selectIcon(this, 'fa-truck')" data-icon="fa-truck"><i class="fas fa-truck"></i></div>
                            <div class="icon-option" onclick="selectIcon(this, 'fa-warehouse')" data-icon="fa-warehouse"><i class="fas fa-warehouse"></i></div>
                        </div>
                        <input type="hidden" id="prod-icone" value="fa-box">
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label>Cor de Destaque</label>
                        <div id="color-selector" style="display: flex; gap: 12px; margin-top: 10px;">
                            <div class="color-option active" onclick="selectColor(this, '#1A5632')" data-color="#1A5632" style="background: #1A5632; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid transparent;"></div>
                            <div class="color-option" onclick="selectColor(this, '#E89C31')" data-color="#E89C31" style="background: #E89C31; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid transparent;"></div>
                            <div class="color-option" onclick="selectColor(this, '#2563eb')" data-color="#2563eb" style="background: #2563eb; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid transparent;"></div>
                            <div class="color-option" onclick="selectColor(this, '#dc2626')" data-color="#dc2626" style="background: #dc2626; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid transparent;"></div>
                            <div class="color-option" onclick="selectColor(this, '#9333ea')" data-color="#9333ea" style="background: #9333ea; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid transparent;"></div>
                            <div class="color-option" onclick="selectColor(this, '#0891b2')" data-color="#0891b2" style="background: #0891b2; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid transparent;"></div>
                        </div>
                        <input type="hidden" id="prod-cor" value="#1A5632">
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label>Estoque Mínimo</label>
                        <input type="number" id="prod-min" value="100">
                    </div>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 32px;">
                    <button type="button" class="btn-danger" onclick="closeProdutoModal()" style="flex: 1; padding: 12px;">Cancelar</button>
                    <button type="submit" class="btn-primary" style="flex: 2; padding: 12px;">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Cadastro Genérico (Cliente/Fornecedor) -->
    <div id="modal-edit" class="modal-overlay">
        <div class="edit-modal" style="max-width: 600px;">
            <div class="panel-header" style="background: var(--primary); color: white; padding: 20px;">
                <h3 id="modal-title" style="margin: 0;">Novo Cadastro</h3>
                <button onclick="closeEditModal()" style="background:none; border:none; font-size:1.8rem; cursor:pointer; color: white;">&times;</button>
            </div>
            <form onsubmit="saveCadastro(event)" class="form-grid">
                <input type="hidden" id="edit-id">
                <input type="hidden" id="edit-type">
                <div class="form-group">
                    <label>Tipo de Pessoa</label>
                    <select id="edit-doc-type" onchange="updateDocMask()">
                        <option value="CNPJ">Pessoa Jurídica (CNPJ)</option>
                        <option value="CPF">Pessoa Física (CPF)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label id="label-doc">CNPJ</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="edit-doc" placeholder="00.000.000/0000-00" style="flex: 1;">
                        <button type="button" class="btn-primary" style="width: 50px; margin-top: 0;" onclick="consultarDocumento()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group span-2">
                    <label>Nome / Razão Social</label>
                    <input type="text" id="edit-nome" required placeholder="Ex: João da Silva ou Empresa LTDA">
                </div>
                <div class="form-group">
                    <label>Inscrição Estadual</label>
                    <input type="text" id="edit-ie" placeholder="Isento">
                </div>
                <div class="form-group">
                    <label>E-mail</label>
                    <input type="email" id="edit-email" placeholder="email@exemplo.com">
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="text" id="edit-tel" placeholder="(00) 00000-0000">
                </div>
                <div class="form-group span-2">
                    <label>Endereço Completo</label>
                    <textarea id="edit-end" rows="2" placeholder="Rua, Número, Bairro, Cidade - UF"></textarea>
                </div>
                <div class="form-group span-2" style="display: flex; gap: 12px; margin-top: 10px;">
                    <button type="button" class="btn-danger" onclick="closeEditModal()" style="flex: 1;">Cancelar</button>
                    <button type="submit" class="btn-primary" style="flex: 2;">Salvar Cadastro</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Busca de Contatos -->
    <div id="modal-search" class="modal-overlay">
        <div class="edit-modal" style="max-width: 500px;">
            <div class="panel-header" style="background: var(--primary); color: white; padding: 20px;">
                <h3 style="margin: 0;">Selecionar Contato</h3>
                <button onclick="closeSearchModal()" style="background:none; border:none; font-size:1.8rem; cursor:pointer; color: white;">&times;</button>
            </div>
            <div style="padding: 20px;">
                <input type="hidden" id="search-type">
                <input type="text" id="search-input" placeholder="Digite para filtrar..." style="width: 100%; margin-bottom: 15px; padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                <div id="search-list" style="max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px;">
                    <!-- Injetado via JS -->
                </div>
            </div>
        </div>
    </div>

    <script>
        if (window.location.protocol === 'file:') {
            document.getElementById('titlebar').style.display = 'flex';
        } else {
            document.querySelector('.sidebar').style.top = '0';
            document.querySelector('.sidebar').style.height = '100vh';
            document.querySelector('.main-content').style.marginTop = '0';
            document.querySelector('.main-content').style.height = '100vh';
        }
    </script>
    <script src="../js/script.js"></script>
</body>
</html>
